<div class="container">
  <div class="mapAndViewer">
    <div class="map flex-auto" [ngClass]="{ minWidth: isData$ | async }">
      <ng-container *ngIf="filteredOverlays$ | async">
        <app-map
          [config]="leafletMapConfig"
          [overlays]="filteredOverlays$ | async"
          [mode]="MODE"
          [cameraConfig]="cameraConfig"
          (map)="mapReady = $event"
        ></app-map>

        <div class="above">
          <div class="cards">
            <app-map-card (action)="onMapCardAction($event)"></app-map-card>
          </div>
        </div>
      </ng-container>
    </div>
    <div class="flex-initial bg-gray-200" [@slide]="isViewer$ | async">
      <div class="viewer" *ngIf="isViewer$ | async" [ngClass]="{ fullscreen: isViewerFullscreen$ | async }">
        <!-- TODO : Add config  -->
        <ng-container *ngIf="selectedPicture.type === '360'">
          <app-panorama
            [image]="selectedPicture"
            [config]="config"
            (params)="onChangeViewParams($event)"
          ></app-panorama>
          <!-- <app-navigation-perspective
            [picturePoint]="picturePoint"
            [picture]="selectedPicture"
            (direction)="onChangeNeighboursDirection($event)"
          ></app-navigation-perspective> -->
        </ng-container>
        <ng-container *ngIf="selectedPicture.type === 'flat'">
          <app-flat-image
            *ngIf="selectedPicture.type === 'flat'"
            [picture]="selectedPicture"
            [zoom]="false"
          ></app-flat-image>
          <app-navigation-perspective
            [picturePoint]="picturePoint"
            [picture]="selectedPicture"
            (direction)="onChangeNeighboursDirection($event)"
          ></app-navigation-perspective>
          <app-car-compass
            [pictures]="picturePoint.pictures"
            [selected]="selectedPicture.camera"
            (camera)="onChangeCameraPosition($event)"
          ></app-car-compass>
        </ng-container>

        <div id="buttons">
          <button
            class="item"
            matTooltip="Fermer la navigation"
            matTooltipPosition="left"
            (click)="onCloseNavigation()"
          >
            <mat-icon class="icon icon-size-18" svgIcon="mat_outline:clear"></mat-icon>
          </button>
          <button
            class="item"
            matTooltip="Plein écran"
            matTooltipPosition="left"
            (click)="onFullscreenNavigation()"
            *ngIf="!(isViewerFullscreen$ | async)"
          >
            <mat-icon class="icon icon-size-18" svgIcon="mat_outline:fullscreen"></mat-icon>
          </button>
          <button
            class="item"
            matTooltip="Réduire l'écran"
            matTooltipPosition="left"
            (click)="onFullscreenNavigation()"
            *ngIf="isViewerFullscreen$ | async"
          >
            <mat-icon class="icon icon-size-18" svgIcon="mat_outline:fullscreen_exit"></mat-icon>
          </button>
          <button class="item infos" matTooltipPosition="left" [matTooltip]="viewerImageInfos">
            <mat-icon class="icon icon-size-18" svgIcon="mat_outline:info"></mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="data flex-auto" [@slideHeight]="isData$ | async">
    <app-dynamic-table
      *ngIf="(activeProperties$ | async) && (isData$ | async)"
      [data]="activeProperties$ | async"
      (activeRow)="onFlyToTheFeature($event)"
    ></app-dynamic-table>
  </div>
</div>
